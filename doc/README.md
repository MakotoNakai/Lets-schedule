# ミーティング日時調整webアプリケーション Let’s Schedule 要件定義書

## 目的

本ドキュメントでは筆者が開発するミーティング日程調整アプリに実装予定の機能を定義する。

## アプリ概要

 本アプリはミーティングの日程調整時に、各参加者の予定を元に全員が参加可能な日時を提案するwebアプリである。

具体的には

ミーティングの候補日時の1つずつにリアクション（例: O/△/X）するのではなく、主催者・参加者共に範囲で入力できる
→ ユーザーの入力の手間が減る


ミーティング日程調整をサービス内で完結させる
→ 部外秘ミーティングの情報でもURLで外部に公開することがない


ユーザーのメールアドレスのドメインに非依存である
→ GmailやOutlook.comのみならず、他のドメインのメールアドレスを使いたいユーザーにも日程調整機能を提供する


確定したミーティングの日時をicsファイル、Googleカレンダー、Outlookカレンダーなど、様々なフォーマットで提供する
 

## （参考）既存アプリに対する優位性

サービス内での日程調整の流れは以下の通りである。

- 主催者日時入力
主催者がミーティングの詳細(概要・候補日時等)を設定する


- 参加者通知
作成したミーティングを参加者に通知する

- 参加者日時入力
参加者が参加できる時間の範囲を入力する
 
- 時間決定
主催者が最終的な開催日時を決定する
 
- カレンダーへの登録
決まった予定をユーザーのカレンダーに登録する 


これらの点について以下の既存サービスと比較することで、本アプリの優位性を明確にする。

| | 主催者日時入力 | 参加者通知 | 参加者日時入力 | 日時決定 | カレンダーへの登録 | サービスへの使用条件 |
| ---- | ---- | ---- | ---- | ---- | ---- |---- |
| Let's Schedule | 候補入力 | サービス内で完結 | 参加できる日時を範囲入力 | 主催者が決定 | icsファイル Google Calendar・Outlook Calendarのリンク発行 | メアド制限なし |
| 調整さん | 候補日時1つずつ入力| 公開URL | 候補日時ごとに◯/X/△ | 全員が参加できる日時を色付け | なし | メアド
制限なし |
| Google Calendar | 候補日時範囲入力/自動抽出 | メール | 候補日時ごとにYes/No/Maybe | 主催者が決定 | Google
Calendarに登録| メアド制限なし (ただしGmail以外は別途連携必要) |
| Microsoft Outlook | 候補日時範囲入力/自動抽出 | メール | 候補日時ごとにYes/No | 主催者が決定 | Outlook
Calendarに登録 | Outlook Emailユーザーのみ |


### 候補日時設定

(GoogleカレンダーやOutlookカレンダーなどの同一ドメイン向けのサービスを除き)
 ミーティング主催者が候補日時を細切れ複数入力するよりも、都合の良い時間帯を範囲で入力する方が主催者の入力の手間が少なくなる。

### 参加者通知

 公開URLを採用する場合、ミーティングの内容が部外秘の内容であっても人為的ミスでURLを部外者に公開するリスクがある。
 メール経由であれば、受信フォルダの中から招待メールを探すのに手間がかかるケースが考えられる。
 これらの欠点を克服する手段として、参加者へのミーティングの通知をサービス内で完結させるという仕組みが考えられる。




参加者時間入力

 ミーティング参加者が日時を入力する際に主催者に決められた日時1つずつに対してO/X/△のリアクションをするよりも、参加者自身が都合の良い日時の範囲を入力した方が参加者にとって直感的な操作が実現できる。

日時決定

他のサービス同様候補日時の中から主催者が決定する


カレンダーへの登録

 Googleサービスなどの特定のプラットフォーム内で完結するものではなく、icsファイル、Googleカレンダーのリンク、Outlookカレンダーのリンクなど様々な形で予定を登録できるようにする

サービスの使用条件

 メールアドレスさえあれば利用できるようにすることで、GmailやOutlookユーザー以外も利用できるようにする



技術要件

本webアプリに導入する技術は以下の通りである。

前提条件 
webブラウザからアクセスできる
Htmlファイルが使えるブラウザを使用する
端末のディスプレイに応じた画面サイズに応じた表示をする
制約条件 
webアプリの管理者は開発者(中井)のみ
稼働率は99.5%である (24時間365日の稼働時間は保証しない)
同時接続数は51,300である

アプリケーションのアーキテクチャ
選定技術: SPA (single page architecture)
選定理由: 
必要最低限のデータを読み込むのでページの遷移が高速になる
フロントエンド側・バックエンド側の実装が分離できるので、それぞれの実装に専念できる
 
選定技術: MVCアーキテクチャ
選定理由: 
Model (DBとの通信やデータの制約の定義)
View(ページを表示するUI)
Controller (REST APIのエンドポイントでの処理)の実装が分離できる


インフラのアーキテクチャ 
選定技術: 3層アーキテクチャ
選定理由: 
MVCアーキテクチャを物理的に反映できる

Webサーバー: Viewをデプロイサーバー
APサーバー:  Model・Controllerを提供するサーバー
DBサーバー: Modelで定義されたデータを保存するサーバー
フロントエンド 
選定技術: Vue.js
選定理由: 
HTMLとJavaScript部分を分離できるので可読性が高い 
 (参考) ReactのJSXはJavaScriptの中にhtmlを書くので読みづらくなる恐れがある
    Component-basedな実装方法の新規学習コストが高い
バックエンド
選定技術: Golang (Echo)
Golangの選定理由:
記法がシンプルで可読性が高い
シングルバイナリ (ビルド・デプロイが短時間でできる)
処理が早い 
Echoの選定理由: 
小規模フレームワーク
インフラ
選定技術: AWS (EC2)
選定理由: 
業務で使用経験があるので馴染みがある
DB 
選定技術: MySQL
選定理由: 
PostgreSQLが得意な複雑なクエリの実装・大規模データ処理が必要ない




















機能要件

サービスに要求される機能

セキュリティ

セッション保持
Cookie保存は情報漏洩のリスクあり
Cookieデータで詐称もできる
ユーザーは前提としてステータスなし
→ だからCookieを置いてステータスにする
練習としてCookie実装 
(仕事ではレンダリング時にコントローラーを追加)
共有メモリ使う前に、本来は先にメモリを割り当てるべき

認証
Basic認証 → JWT
OAuth OpenID


証明書
AWS Certificate Manager
https://aws.amazon.com/certificate-manager/





システム管理者

ユーザー情報表示
ユーザー無効化 (主催者権限譲渡 → ログイン権限剥奪)
ミーティング情報表示
ミーティング無効化 (参加者全員のユーザー名無効化)
ミーティング参加者表示
ミーティング候補日時表示



ユーザー共通


ユーザー新規作成
ユーザー設定変更 (ユーザーネーム・メールアドレス・パスワード)
ユーザー削除 (ユーザー自身)
ログイン
ログアウト
予定日時ダウンロード (ics, Google Calendar, Outlook Calendar)

ミーティング主催者

ミーティング新規作成
ミーティング情報編集
ミーティング削除
参加できる時間を入力
参加できる時間を送信
最終的な日時を選択
選択した日時を参加者に通知
回答状況を表示
管理者権限の譲渡

ミーティング参加者  (主催者以外)

参加できる時間を入力
参加できる時間を送信













DB設計

ユーザーテーブル (usersテーブル)

| 項目名 (日本語) | 項目名 (変数) | 型 | 備考 | 
| ---- | ---- | ---- | ---- |
| ユーザー名 | username | string | NOT NULL |
| メールアドレス | emailAddress | string | NOT NULL |
| パスワード | password | base64 | NOT NULL |
| 管理者かどうか | isAdmin | bool | NOT NULL |
| ログイン可能か | canLogin | bool | NOT NULL |


ミーティングテーブル (meetingsテーブル)

| 項目名 (日本語) | 項目名 (変数) | 型 | 備考 | 
| ---- | ---- | ---- | ---- |
| ミーティングID | meetingId | int | NOT NULL |
| ミーティング名 | meetingTitle | string | NOT NULL |
| 概要 | description | text | NOT NULL |
| 管理者かどうか | isAdmin | bool | NOT NULL |
| ログイン可能か | canLogin | bool | NOT NULL |
| 開始日時 | startTime | datetime | 最終的な開始日時 |
| 終了日時 | endTime | datetime | 最終的な終了日時 |
| 形式 | type | string | 現地 or オンライン |
| 集合場所 | meetingPlace | string | |
| ミーティングURL | meetingUrl | string | |


参加者テーブル (participantsテーブル)

| 項目名 (日本語) | 項目名 (変数) | 型 | 備考 | 
| ---- | ---- | ---- | ---- |
| ミーティングID | meetingId | int | NOT NULL |
| ユーザーネーム | username | string |  |
| 主催者かどうか | isHost | bool |  |
| 回答の有無 | hasResponded | bool |  |


候補日時テーブル (candidate_timeテーブル)

| 項目名 (日本語) | 項目名 (変数) | 型 | 備考 | 
| ---- | ---- | ---- | ---- |
| ミーティングID | meetingId | int | NOT NULL |
| ユーザーネーム | username | string | NOT NULL |
| 開始時間 | startTime | datetime | NOT NULL |
| 終了時間 | endTime | datetime | NOT NULL |


API仕様

共通事項

各APIは次のフォーマットのURLとする

https://letsschedule.com/<エンドポイントのパス>

バージョン: APIのバージョン 例: v1
パス: 各APIのURLパス

通信プロトコル: HTTPS
APIの種類: REST API
インターフェース: JSON
文字コード: UTF-8

ユーザーAPI エンドポイント [api/v1/users]

Header

Basic認証 → JWT → CSRF























POST api/v1/users/create

リクエストパラメータ

| キー名 | 型 (変数) | 概要 | 
| -- | -- | -- | 
| username | string | ユーザー名 | 
| email_address | string | メールアドレス | 
| password | string | パスワード | 


ステータスコード

| コード | 意味 |
| -- | -- | 
| 200 | ユーザー登録成功 |
| 400 | ユーザー登録失敗 |

レスポンスパラメータ

| キー名 | 型 | 概要 |
| -- | -- | -- | 
| result | bool | ユーザー登録成功/失敗 | 


成功時レスポンス
```
{
  “result”: true,
  “status”: 200
}
```

失敗時レスポンス
```
{
  “result”: false,
  “status”: 400,
  “Message”: [エラーメッセージ]
}
```


GET api/v1/users/:userId/edit

パラメータ

| キー名 | 型 (変数) | 概要 | 
| -- | -- | -- |
| username | string | ユーザー名 |


ステータスコード

| コード | 意味 |
| -- | -- | 
| 200 | 成功 | 
| 400 | ユーザー情報取得失敗 | 



レスポンスパラメータ

| キー名 | 型 (変数) | 概要 | 
| -- | -- | -- |
| username | string | ユーザー名 |
| email_address | string | メールアドレス |
| password | string | パスワード |


成功時レスポンス

```
{
  “status”: 200,
  “username”: [ユーザー名],
  “email”: [メールアドレス],
  “password”: [パスワード]
}
```

失敗時レスポンス
```
{
  “Status”: 400,
  “Message”: [エラーメッセージ]
}
```


PUT api/v1/users/:username/edit

パラメータ

| キー名 | 型 (変数) | 概要 | 
| -- | -- | -- |
| username | string | ユーザー名 |
| email_address | string | メールアドレス |
| password | string | パスワード |


ステータスコード

| コード | 意味 |
| -- | -- | 
| 200 | 成功 | 
| 400 | ユーザー情報編集失敗 | 

成功時レスポンス
```
{
  “status”: 200
}
```

失敗時レスポンス
```
{
  “status”: 400,
  “message”: [エラーメッセージ]
}
```


DELETE api/v1/users/:username/delete

パラメータ

| キー名 | 型 (変数) | 概要 | 
| -- | -- | -- |
| userId | int | ユーザーID |


ステータスコード

| コード | 意味 |
| -- | -- |
| 200 | 成功 |
| 400 | アカウント削除失敗 |


成功時レスポンス
```
{
  “status”: 200,
}
```

失敗時レスポンス
```
{
  “status”: 400,
  “message”: [エラーメッセージ]
}
```


ミーティングAPI エンドポイント [api/v1/meetings]

POST api/v1/meetings/create

パラメータ

| キー名 | 型 (変数) | 概要 | 
| -- | -- | -- |
| meetingTitle | string | ミーティング名 |
| description | text | 概要 |
| start_datetime | datetime | 開始日時 |
| end_datetime | datetime | 終了日時 |
| type | string | 形式 |
| meeting_place | string | 集合場所 |
| meeting_url | string | ミーティングURL |


ステータスコード

| コード | 意味 |
| -- | -- |
| 200 | ミーティング登録成功 |
| 400 | ミーティング登録失敗 |


レスポンスパラメータ

| キー名 | 型 (変数) | 概要 | 
| -- | -- | -- |
| meetingId | string | ミーティングID |




成功時レスポンス
```
{
  “status”: 200,
}
```

失敗時レスポンス
```
{
  “status”: 400,
  “message”: [エラーメッセージ]
}
```


GET api/v1/meetings/:meetingId

パラメータ

| キー名 | 型 (変数) | 概要 | 
| -- | -- | -- |
| meetingId | string | ミーティングID |


ステータスコード

| コード | 意味 |
| -- | -- |
| 200 | ミーティング情報取得成功 |
| 400 | ミーティング情報取得失敗 |


レスポンスパラメータ

| キー名 | 型 (変数) | 概要 | 
| meetingTitle | string | ミーティング名 |
| -- | -- | -- |
| description | text | 概要 |
| start_datetime | datetime | 開始日時 |
| end_datetime | datetime | 終了日時 |
| type | string | 形式 |
| meeting_place | string | 集合場所 |
| meeting_url | string | ミーティングURL |



成功時レスポンス

```
{
  “status”: 200,
  “meetingTitle”: [ミーティングタイトル],
  “description”: [ミーティングの概要],
  “start_datetime”: [ミーティングの開始時間],
  “end_datetime”: [ミーティングの終了時間],
  “type”: [ミーティングの形式],
  “meeting_place”: [ミーティングの集合場所],
  “meeting_url”: [ミーティングのURL]
}
```

失敗時レスポンス

```
{
  “status”: 400,
  “message”: [エラーメッセージ]
}
```


PUT api/v1/meetings/:meetingId/update

パラメータ

| キー名 | 型 (変数) | 概要 |
| -- | -- | -- |
| meetingId | string | ミーティング名 |


ステータスコード

| コード | 意味 |
| -- | -- |
| 200 | ミーティング情報編集成功 |
| 400 | ミーティング情報編集失敗 |


成功時レスポンス

```
{
  “status”: 200
}
```

失敗時レスポンス

```
{
  “status”: 400,
  “message”: [エラーメッセージ]
}
```


DELETE api/v1/meetings/:meetingId/delete

リクエストパラメータ

| キー名 | 型 (変数) | 概要 |
| -- | -- | -- |
| meetingId | string | ミーティング名 |


ステータスコード

| コード | 意味 |
| -- | -- |
| 200 | ミーティング削除成功 |
| 400 | ミーティング削除失敗 |


成功時レスポンス

```
{
  “status”: 200
}
```

失敗時レスポンス

```
{
  “status”: 400,
  “message”: [エラーメッセージ]
}
```


メンバーAPI

エンドポイント [api/v1/members]

POST api/v1/members/create


リクエストパラメータ

| キー名 | 型 (変数) | 概要 |
| -- | -- | -- |
| meetingTitle | string | ミーティング名 |
| username | string | ユーザーネーム |
| isHost | bool | 主催者かどうか |
| hasResponded | bool | 回答の有無 |


ステータスコード

| コード | 意味 |
| -- | -- |
| 200 | ミーティング参加者登録成功 |
| 400 | ミーティング参加者登録失敗 |


成功時レスポンス

```
{
  “status”: 200
}
```

失敗時レスポンス

```
{
  “status”: 400,
  “message”: [エラーメッセージ]
}
```

GET api/v1/members/:meetingId

リクエストパラメータ

| キー名 | 型 (変数) | 概要 |
| -- | -- | -- |
| meetingId | string | ミーティング名 |


ステータスコード

| コード | 意味 |
| -- | -- |
| 200 | ミーティング参加者取得成功 |
| 400 | ミーティング参加者取得失敗 |


成功時レスポンス

```
{
  “status”: 200,
  “meetingTitle”: [ミーティングのタイトル],
  “usernames”: [
 	{
  “username”: [参加者のユーザー名],
  “isHost”: [参加者が主催者かどうか],
   “hasResponded”: [参加者が参加時間を回答したか]
 }
]
}
```

失敗時レスポンス

```
{
  “status”: 400,
  “message”: [エラーメッセージ]
}
```


PUT api/v1/members/:id/update

リクエストパラメータ


| キー名 | 型 (変数) | 概要 |
| -- | -- | -- |
| meetingTitle | string | ミーティング名 |
| username | string | ユーザーネーム |
| isHost | bool | 主催者かどうか |
| hasResponded | bool | 回答の有無 |


ステータスコード

| コード | 意味 |
| -- | -- |
| 200 | ミーティング参加者編集成功 |
| 400 | ミーティング参加者編集失敗 |


成功時レスポンス

```
{
  “status”: 200
}
```

失敗時レスポンス

```
{
  “status”: 400,
  “message”: [エラーメッセージ]
}
```


DELETE api/v1/members/:id/delete

リクエストパラメータ

| キー名 | 型 (変数) | 概要 |
| -- | -- | -- |
| meetingId | string | ミーティング名 |


ステータスコード

| コード | 意味 |
| -- | -- |
| 200 | ミーティング参加者削除成功 |
| 400 | ミーティング参加者削除失敗 |


成功時レスポンス

```
{
  “status”: 200
}
```

失敗時レスポンス

```
{
  “status”: 400,
  “message”: [エラーメッセージ]
}
```

候補日時API エンドポイント [api/v1/candidate-times]

POST api/v1/candidate-times/create

リクエストパラメータ


| キー名 | 型 (変数) | 概要 |
| -- | -- | -- |
| meetingId | string | ミーティング名 |
| username | username | ユーザーネーム |
| startTime | datetime | 開始時間 |
| endTime | datetime | 終了時間 |


ステータスコード

| コード | 意味 |
| -- | -- |
| 200 | ミーティング候補日時登録成功 |
| 400 | ミーティング候補日時登録失敗 |


成功時レスポンス

```
{
  “status”: 200
}
```



失敗時レスポンス

```
{
  “status”: 400,
  “message”: [エラーメッセージ]
}
```


GET api/v1/candidate-times/:meetingId

リクエストパラメータ

| キー名 | 型 (変数) | 概要 |
| -- | -- | -- |
| meetingId | string | ミーティングID |



ステータスコード

| コード | 意味 |
| -- | -- |
| 200 | ミーティング候補日時取得成功 |
| 400 | ミーティング候補日時取得失敗 |


レスポンスパラメータ

| キー名 | 型 (変数) | 概要 |
| -- | -- | -- |
| username | string | ユーザーネーム |
| startTime | datetime | 開始時間 |
| endTime | datetime | 終了時間 |


成功時レスポンス

```
{
  “status”: 200
  “
}
```

失敗時レスポンス

```
{
  “status”: 400,
  “message”: [エラーメッセージ]
}
```


PUT api/v1/candidate-times/:meetingId/update

リクエストパラメータ


| キー名 | 型 (変数) | 概要 |
| -- | -- | -- |
| meetingId | string | ミーティング名 |
| username | string | ユーザーネーム |
| startTime | datetime | 開始時間 |
| endTime | datetime | 終了時間 |


ステータスコード

| コード | 意味 |
| -- | -- |
| 200 | ミーティング候補日時編集成功 |
| 400 | ミーティング候補日時編集失敗 |


成功時レスポンス

```
{
  “status”: 200
  “
}
```


失敗時レスポンス

```
{
  “status”: 400,
  “message”: [エラーメッセージ]
}
```


DELETE api/v1/candidate-times/:meetingId/delete

リクエストパラメータ

| キー名 | 型 (変数) | 概要 |
| -- | -- | -- |
| meetingId | string | ミーティングID |


ステータスコード

| コード | 意味 |
| -- | -- |
| 200 | ミーティング候補日時削除成功 |
| 400 | ミーティング候補日時削除失敗 |


成功時レスポンス

```
{
  “status”: 200
  “
}
```



失敗時レスポンス

```
{
  “status”: 400,
  “message”: [エラーメッセージ]
}
```



画面

フロントページ

ログイン画面
ユーザー名
パスワード
パスワードを忘れた場合

ユーザー登録画面
メアド
ユーザー名
パスワード

パスワード再設定画面
メアド
パスワード
パスワード (確認用)

ダッシュボード
主催ミーティング一覧
参加ミーティング一覧
ミーティング作成ボタン

ミーティング新規作成画面
ミーティング名
概要
予定日時
形式
参加者
作成ボタン
止めるボタン


主催しているミーティング詳細画面
ミーティング名
概要
予定日時
形式
参加者
誰が回答してるか / してないか
最適な時間帯
最終決定ボタン
編集ボタン
削除ボタン


参加しているミーティング詳細画面
ミーティング名
概要
予定日時
形式
参加者
回答欄
編集ボタン
削除ボタン

設定画面
メアド変更
ユーザー名変更












非機能要件

同時接続数

研究室のメンバー (教員・学生含め) 110人 
合唱団のメンバー 38人
日常的に連絡を取っている友人 10人 
友人が参加する集まりの参加者数 10人程度

合計 (110 + 38 + 10 * 10 =) 248 接続数

レスポンスタイム (クライアントからの通信 ~ クライアントへの受信) 
100ms


インフラ構成

記事 (https://qiita.com/toast-uz/items/9a5c14b8e2b4736e6616)によるとAWS EC2 t2タイプの同時接続数は51,300なので、EC2インスタンスはt2-micro


LB間の名前解決の切り替えが必要
MySQLの分散DB化


可用性 
約 99.6%
単一インスタンスの可用性最低99.5%
(https://aws.amazon.com/compute/sla/?nc1=h_ls)

 1 - (1 - 0.995) ** 2 ≒ 0.9996059576745632…


